before_install:
  - apt-get --quiet update --yes
  - apt-get --quiet install --yes wget tar unzip lib32stdc++6 lib32z1 libgmp-dev
  - apt-get install jq automake autoconf libtool pkg-config gettext perl python flex bison gperf
  - wget --quiet --output-document=android-sdk.zip https://dl.google.com/android/repository/sdk-tools-linux-4333796.zip
  - unzip -d android-sdk-linux android-sdk.zip
  - echo y | android-sdk-linux/tools/bin/sdkmanager "platforms;android-33" >/dev/null
  - echo y | android-sdk-linux/tools/bin/sdkmanager "platform-tools" >/dev/null
  - echo y | android-sdk-linux/tools/bin/sdkmanager "build-tools;33.0.2" >/dev/null
  - echo y | android-sdk-linux/tools/bin/sdkmanager "ndk;21.3.6528147" >/dev/null
  - export ANDROID_HOME=$PWD/android-sdk-linux
  - export PATH=$PATH:$PWD/android-sdk-linux/platform-tools/
  - chmod +x ./gradlew
  - set +o pipefail
  - yes | android-sdk-linux/tools/bin/sdkmanager --licenses
  - set -o pipefail
  - export ANDROID_NDK_ROOT=$PWD/android-sdk-linux
  - ls $PWD
  - export OPENSSL_SRC=$PWD/openssl
  - export NO_DOCKER=true
  - cd strongswan/src/frontends/android/openssl
  - ./compile.sh
  - echo 'Done compiling openssl'
  - cd ../../../../
  - ls
  - ./autogen.sh
  - echo 'Done auto gen'
  - ./configure.sh
  - echo 'Done configure'
  - make dist
install:
  - echo 'Done making dist'
  - cd strongswan/src/frontends/android
  - sed -i -e '/app\ {/alintOptions\ {abortOnError\ false}' build.gradle
  - gradle assembleRelease
  - cd strongswan/src/frontends/android
  - ./gradlew assembleRelease
  - cd ../../../
  - ls
  - cp -r strongswan/src/frontends/android/app/src/main/libs/* app/src/libs
  - rm -fr strongswan/src/frontends/android/app/src/main/libs/*
  - rm -fr strongswan/src/frontends/android/app/build
  - ./gradlew build publishToMavenLocal
